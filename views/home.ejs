<%- include('./partials/header.ejs', { allposts, allstories, loggedinuser, allcomments }) %>
  <style>
    @font-face {
  font-family: gilroy;
  src: url(../fonts/Gilroy-Light.ttf);
}
*{
margin:0;
padding: 0;
box-sizing: border-box;
}
html,body{
font-family: gilroy;
width: 100%;
scroll-behavior: smooth;
}
:root{
  font-size: 62.5%;
}
    #homepage {
      padding-left: 20%;
      min-height: 100vh;
      width: 70%;
    }

    #homeposts {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }

    #homepostsnav {
      width: 70%;
      position: relative;
      height: 6vh;
      display: flex;
      margin-bottom: 1vh;
      align-items: center;
      padding-left: 2vh;
    }
    #homepostsnav a h2{
      font-size: 1.7vw;
      transform: translate(-2vh, 0vh);
    }

    #homepostsprofile {
      height: 60vh;
      border: 1px solid rgba(128, 128, 128, 0.454);
      width: 65%;
      overflow: hidden;
      padding: 1vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 1vh;
    }

    #homeposts h2 {
      font-size: 1.5vw;
      font-weight: 400;
      margin-left: 2vh;
    }

    #homepostsfootericons {
      width: 70%;
      height: 5vh;
      padding-left: 2vh;
      position: relative;
      align-items: center;
      font-size: 2vw;
      gap: 1vw;
      display: flex;
    }

    #homepostsfooter {
      width: 70%;
      height: 9vh;
      display: flex;
      align-items: center;
    }

    #homepostnavprofile {
      height: 5vh;
      width: 5vh;
      overflow: hidden;
      border-radius: 50%;
      border: 1px solid white;
    }

    #homepostnavprofile img {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }

    #homeposts a {
      text-decoration: none;
      color: white;
    }

    #homepostsprofile img {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }
    #commentForm{
      position: absolute;
      bottom: -50%;
      opacity: 0;
      transition: all linear .5s;
    }
    #commentbox {
      position: absolute;
      bottom: -50%;
      opacity: 0;
      transition: all linear .5s;
      max-height: 30vh;
      padding-bottom: 30px;
      height: fit-content;
      width: 100%;
      overflow-y: scroll;
      color: rgba(255, 255, 255, 0.772);
      background: linear-gradient(transparent,black,black);
    }
    #commentsubmit,#loggedinusercommentsubmit{
            background: transparent;
            outline: none;
            border: none;
            color: rgb(123, 123, 216);
            font-size: 1vw;
            margin-left: 5vh;

    }
    #commentbox::-webkit-scrollbar {
      display: none;
    }
    #commentinput,#loggedinusercommentinput{
      margin-left: 3vh;
            height: 5vh;
            background-color: transparent;
            outline: none;
            border: none;
            width: 60%;
            padding-left: 1vh;
            color: rgb(255, 252, 252);
            font-size: 1vw;
    }

    #homepostsprofile form {
      bottom: 0%;
      align-items: center;
      position: absolute;
      width: 100%;
      z-index: 9;
      background-color: black;
      display: flex;
    }

    #commentwala {
      height: fit-content;
      padding: .5vw;
      width: 100%;
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.365);
      align-items: center;
    }
    #createstory{
      position: relative;
    }
    #createstory img{
      height: 10vh;
        margin-left: 2vh;
        width: 10vh;
        object-fit: cover;
        overflow: hidden;
        border-radius: 50%;
    }
    #plus{
      position: absolute;
      height: 2.5vh;
      font-size: 1.5vw;
      border-radius: 50%;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 2.5vh;
      background-color: rgb(0, 179, 255);
      bottom: .5vh;
      right: 0;
    }
    #createstorydiv{
      position: absolute;
      top: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99;
      left: 0;
      height: 100vh;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.616);
    }
    #createstorydivbox{
      height: 90vh;
      /* background-image: url(/images/bcg.jpg); */
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      width: 28%;
      border-radius: 10px;
      /* padding-top: 3vh; */
      /* background-color: aqua; */
      background: linear-gradient( #f9ce34, #ee2a7b , #6228d7);
    }
    #storynav{
      padding-left: 1vh;
      display: flex;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.463);
      justify-content: space-between;
    }
    #storynav i:nth-child(1){
      /* padding: 1vw; */
      border-radius: 50%;
      font-size: 2vw;
        }
    #storynav i:nth-child(2){
      /* padding: 1vw; */
      margin-left: 35vh;
      font-size: 1vw;
      padding-top: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 3.2vh;
      width: 3.2vh;
      border: 3px solid white;
        }
    #storynav i:nth-child(3){
      /* padding: 1vw; */
      /* margin-left: 35vh; */
      font-size: 1vw;
      padding-top: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 3.2vh;
      width: 3.2vh;
      border: 3px solid white;
        }
    #storynav i:nth-child(4){
      /* padding: 1vw; */
      border-radius: 50%;
      font-size: 2vw;
      margin-right: 2vh;
        }
        #storymain{
          width: 100%;
          position: relative;
          height: 85%;
        }
        #storyimagePreview{
          height: 100%;
          display: flex;
          position: relative;
          justify-content: center;
          align-items: center;
          width: 100%;
        }
        #storytxt textarea{
          top: 0;
          padding: 5vh;
          left: 0;
          color: white;
          position: absolute;
          font-size: 2vw;
          outline: none;
          border: none;
          display: flex;
          resize: none;
          justify-content: center;
          width: 100%;
          z-index: 999;
          height: 80%;
          align-items: center;
          background-color: transparent;
        }

        #storyimagePreview img{
          height: 100%;
          width: 100%;
          object-fit: cover;
        }
        #storyimagePreview video{
          height: 100%;
          width: 100%;
          object-fit: cover;
        }
        #createstoryinput{
          display: none;

        }
        #storybottom{
          display: flex;
          background-color: rgba(29, 29, 29, 0.55);
          border-radius: 100px;
          align-items: center;
          justify-content: space-evenly;
          height: 5vh;
          width: 13vh;
        }
        #storybottom h5{
          transform: translate(0, 2px);
        }
       
        #storybottom img{
          height: 3vh;
          width: 3vh;
          object-fit: cover;
          border-radius: 50%;
          overflow: hidden;

        }
        #storybottomparent{
          align-items: center;
          height: 7vh;
          width: 100%;
          display: flex;
          justify-content: end;

        }
        #storybottomparent i{
          height: 5vh;
          width: 5vh;
          display: flex;
          justify-content: center;
          align-items: center;
          border-radius: 50%;
          font-size: 1.5vw;
          margin-left: .2vw;
          background-color: rgba(29, 29, 29, 0.55);
        }
        
    #storydiv {
      width: 100%;
      height: 15vh;
      margin-bottom: 5vh;
      display: flex;
      overflow: hidden;
      overflow: scroll;
      align-items: center;
      gap: 1.1vh;
    }

    #storydiv::-webkit-scrollbar {
      display: none;
    }

    #storywala {
      height: 10vh;
      flex-shrink: 0;
      overflow: hidden;
      width: 10vh;
      border-radius: 50%;
      border: 2px solid orange;
    }
    #storywala>img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #homeposts h3{
      width: 64%;
      font-weight: 400;
      height: fit-content;
    }
    .ri-bookmark-fill,.ri-bookmark-line{
    margin-left: 20vw;
  }
  #options{
    position: absolute;
    z-index: 9;
    right: 2vh;
    font-size: 2vw;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 5vh;
    /* width: 2vh; */
  }
  #options a{
    display: none;
    font-size: 1.2vw;
  }
  #caughtup{
    position: relative;
    height: 50vh;
    width: 100%;
    display: flex;
    justify-content: end;
    flex-direction: column;
    align-items: center;
    background-image: url(../images/caught.jpg);
    background-position: center;
    background-size: cover;
  }
  #caughtup h3{
    display: flex;
    align-items: center;
    justify-content: center;
    color: cornflowerblue;
    font-size: 1.3vw;
    background-color: rgb(0, 0, 0);
    width:30vh;
    height: 10vh;

    position: absolute;
  }


/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */
/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */
/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */
/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */
/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */
/* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  *//* media media medai medai  */


  @media(max-width:600px) {
    @font-face {
  font-family: gilroy;
  src: url(../fonts/Gilroy-Light.ttf);
}
*{
margin:0;
padding: 0;
box-sizing: border-box;
}
html,body{
font-family: gilroy;
width: 100%;
scroll-behavior: smooth;
}
:root{
  font-size: 62.5%;
}
    #homepage {
      padding-left: 0%;
      min-height: 100vh;
      width: 100%;
    }

    #homeposts {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    
    #homepostsnav {
      width: 100%;
      position: relative;
      height: 6vh;
      display: flex;
      margin-bottom: 1vh;
      align-items: center;
      padding-left: 2vh;
    }
    #homepostsnav a h2{
      font-size: 5vw;
      transform: translate(-2vh, .5vh);
    }
    #homepostsprofile {
      height: 60vh;
      border: 1px solid rgba(128, 128, 128, 0.454);
      width: 100%;
      overflow: hidden;
      padding: 1vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      margin-bottom: 1vh;
    }

    #commentForm{
      position: absolute;
      bottom: -50%;
      opacity: 0;
      transition: all linear .5s;
    }

    #homeposts h2 {
      font-size: 4vw;
      font-weight: 400;
      margin-left: 2vh;
    }

    #homepostsfootericons {
      width: 100%;
      height: 5vh;
      padding-left: 2vh;
      position: relative;
      align-items: center;
      font-size: 6vw;
      gap: 1vw;
      display: flex;
    }

    #homepostsfooter {
      width: 100%;
      height: 3vh;
      display: flex;
      align-items: center;
    }

    #homepostnavprofile {
      height: 4vh;
      width: 4vh;
      overflow: hidden;
      border-radius: 50%;
      border: 1px solid white;
    }

    #homepostnavprofile img {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }

    #homeposts a {
      text-decoration: none;
      color: white;
    }

    #homepostsprofile img {
      height: 100%;
      width: 100%;
      object-fit: cover;
    }

    #commentbox {
      position: absolute;
      bottom: -50%;
      opacity: 0;
      transition: all linear .5s;
      max-height: 22vh;
      padding-bottom: 30px;
      height: fit-content;
      width: 100%;
      overflow-y: scroll;
      color: rgba(255, 255, 255, 0.772);
      background: linear-gradient(transparent,black,black);
    }

    #commentbox::-webkit-scrollbar {
      display: none;
    }

    #commentsubmit,#loggedinusercommentsubmit{
            background: transparent;
            outline: none;
            border: none;
            color: rgb(123, 123, 216);
            font-size: 1vw;
            height: 2vh;
            font-size: 3.5vw;
            width: 20vw;
            margin-left: 5vh;

    }
    #commentinput,#loggedinusercommentinput{
      margin-left: 1vh;
            height: 5vh;
            background-color: transparent;
            outline: none;
            border: none;
            width: 60%;
            padding-left: 1vh;
            color: rgb(255, 252, 252);
            font-size: 3.5vw;
    }
    #homepostsprofile form {
      bottom: 0%;
      align-items: center;
      position: absolute;
      width: 100%;
      z-index: 9;
      background-color: black;
      display: flex;
    }

    #commentwala {
      height: fit-content;
      padding: .5vw;
      width: 100%;
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.365);
      align-items: center;
    }
    #createstory{
      position: relative;
    }
    #createstory img{
      height: 8vh;
        margin-left: 2vh;
        width: 8vh;
        object-fit: cover;
        overflow: hidden;
        border-radius: 50%;
    }
    #plus{
      position: absolute;
      height: 2vh;
      font-size: 4vw;
      border-radius: 50%;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 2vh;
      background-color: rgb(0, 179, 255);
      bottom: .5vh;
      right: 0;
    }
    #createstorydiv{
      position: absolute;
      top: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 99;
      left: 0;
      height: 100vh;
      width: 100%;
      background-color: rgba(0, 0, 0, 0.616);
    }
    #createstorydivbox{
      height: 94vh;
      margin-bottom: 10vh;
      /* background-image: url(/images/bcg.jpg); */
      background-repeat: no-repeat;
      background-size: cover;
      background-position: center;
      width: 100%;
      border-radius: 10px;
      /* padding-top: 3vh; */
      /* background-color: aqua; */
      background: linear-gradient( #f9ce34, #ee2a7b , #6228d7);
    }
    #storynav{
      padding-left: 1vh;
      display: flex;
      height: 12vh;
      padding-top: 7vh;
      align-items: center;
      background-color: rgba(0, 0, 0, 0.463);
      justify-content: space-between;
    }
    #storynav i:nth-child(1){
      /* padding: 1vw; */
      border-radius: 50%;
      font-size: 6vw;
        }
    #storynav i:nth-child(2){
      /* padding: 1vw; */
      margin-left: 30vh;
      font-size: 4vw;
      padding-top: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 3.2vh;
      width: 3.2vh;
      border: 3px solid white;
        }
    #storynav i:nth-child(3){
      /* padding: 1vw; */
      /* margin-left: 35vh; */
      font-size: 4vw;
      padding-top: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 3.2vh;
      width: 3.2vh;
      border: 3px solid white;
        }
    #storynav i:nth-child(4){
      /* padding: 1vw; */
      border-radius: 50%;
      font-size: 8vw;
      margin-right: 2vh;
        }
        #storymain{
          width: 100%;
          position: relative;
          height: 85%;
        }
        #storyimagePreview{
          height: 95%;
          display: flex;
          position: relative;
          justify-content: center;
          align-items: center;
          width: 100%;
        }
        #storytxt textarea{
          top: 0;
          padding: 5vh;
          left: 0;
          color: white;
          position: absolute;
          font-size: 6vw;
          outline: none;
          border: none;
          display: flex;
          resize: none;
          justify-content: center;
          width: 100%;
          z-index: 999;
          height: 80%;
          align-items: center;
          background-color: transparent;
        }

        #storyimagePreview img{
          height: 100%;
          width: 100%;
          object-fit: cover;
        }
        #storyimagePreview video{
          height: 100%;
          width: 100%;
          object-fit: cover;
        }
        #createstoryinput{
          display: none;

        }
        #storybottom{
          display: flex;
          background-color: rgba(29, 29, 29, 0.55);
          border-radius: 100px;
          margin-bottom: 7vh;
          z-index: 999;

          align-items: center;
          justify-content: space-evenly;
          height: 5vh;
          width: 13vh;
        }
        #storybottom h5{
          transform: translate(0, 2px);
        }
       
        #storybottom img{
          height: 3vh;
          width: 3vh;
          object-fit: cover;
          border-radius: 50%;
          overflow: hidden;

        }
        #storybottomparent{
          align-items: center;
          height: 7vh;
          width: 100%;
          z-index: 999;

          display: flex;
          justify-content: end;

        }
        #storybottomparent i{
          height: 5vh;
          margin-bottom: 7vh;
          z-index: 999;
          width: 5vh;
          display: flex;
          justify-content: center;
          align-items: center;
          border-radius: 50%;
          font-size: 4vw;
          margin-left: .2vw;
          background-color: rgba(29, 29, 29, 0.55);
        }
        
    #storydiv {
      width: 100%;
      height: 10vh;
      margin-bottom: 1vh;
      display: flex;
      overflow: hidden;
      overflow: scroll;
      align-items: center;
      gap: 1.1vh;
    }

    #storydiv::-webkit-scrollbar {
      display: none;
    }

    #storywala {
      height:8vh;
      flex-shrink: 0;
      overflow: hidden;
      width: 8vh;
      border-radius: 50%;
      border: 2px solid orange;
    }
    #storywala>img{
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    #homeposts h3{
      width: 100%;
      padding-left: 2vh;
      font-weight: 400;
      height: fit-content;
    }
    .ri-bookmark-fill,.ri-bookmark-line{
    margin-left: 73vw;
  }
  #options{
    position: absolute;
    z-index: 9;
    right: 2vh;
    font-size: 4vw;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 5vh;
    /* width: 2vh; */
  }
  #options a{
    display: none;
    font-size: 2.5vw;
  }
  #caughtup{
    position: relative;
    height: 38vh;
    background-color: #6228d7;
    width: 100%;
    display: flex;
    justify-content: end;
    flex-direction: column;
    align-items: center;
    background-image: url(../images/caught.jpg);
    background-position: center;
    background-size: cover;
  }
  #caughtup h3{
    display: flex;
    align-items: center;
    justify-content: center;
    color: cornflowerblue;
    font-size: 4vw;
    background-color: black;
    width:25vh;
    height: 4vh;
   bottom: 3vh; 
    position: absolute;
  }
    
  }




  
  </style>
    <div id="createstorydiv">
      <div id="createstorydivbox">
        <div id="storynav">
          <i class="ri-close-line"></i>
          <i class="ri-send-backward"></i>
          <i class="ri-text"></i>
          <i class="ri-gallery-line"></i>
        </div>
        <div id="storymain">
            <form id="storyform" action="/uploadstory" method="post" enctype="multipart/form-data">
              <div id="storytxt">
                <textarea name="storydata" id="" cols="60" rows="10" placeholder="Write text here"></textarea>
              </div>
              <input type="file" name="createstory" id="createstoryinput">
            </form>
          <div id="storyimagePreview"></div>
        </div>
        <div id="storybottomparent">
          <div id="storybottom">
          <img src="../images/allposts/<%= loggedinuser.image %> " alt="" /> 
            <h5>Your Story</h5>
          </div>
          <i  id="done" class="ri-arrow-right-s-line"></i>
        </div>
      </div>
    </div> 
  <div id="homepage">
    <div id="storydiv">
      <div id="createstory">
        <img src="../images/allposts/<%= loggedinuser.image %> " alt="" /> 
        <div id="plus">+</div> 
      </div>
      <% 
      const storyobject = {}; 
      allstories.reverse().forEach(function(story) {
        if (!storyobject[story.userid._id]) {
      %>
          <a href="/stories/<%=story.userid._id%>"><div id="storywala">
            <img src="../images/allposts/<%= story.userid.image %>" alt="" />
          </div></a>
      <%
          storyobject[story.userid._id] = true;
        }
      });
      %>
      
    </div>
    <% allposts.reverse().forEach(function(post){ %>
          <div id="homeposts">
            <div id="homepostsnav">
              <a href="<%= (post.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + post.userid._id %>"
                style=" font-size: 1.5vw; color: white; text-decoration: none; display: flex; gap: 2vh;">
                <div id="homepostnavprofile">
                  <img src="../images/allposts/<%= post.userid.image %>" alt="" />
                </div>
                <h2><%= post.userid.username %></h2>
             </a>
              <%if(loggedinuser.id == post.userid._id){%>
                <div id="options">
                  <a href="/delete/<%=post._id%>">Delete</a>
                  <i class="ri-more-2-line"></i>
                </div>
                <%}else{%>
                  <a href="/unfollow/<%=post.userid._id%>"><button  style=" margin-left: 1vh;;padding: .7vh 1.5vh;  background-color:transparent; color: white;border-radius: 10px; border: none; font-size: 1vw;">Following</button></a> 
                <%}%>            
            </div>
            <div id="homepostsprofile">
              <form id="commentForm" data-id="<%=post._id%>" action="/comment/<%=post._id%>" method="post">
                <img style="
            height: 4vh;
            margin-left: 2vh;
            width: 4vh;
            overflow: hidden;
            border-radius: 50%;
          " src="../images/allposts/<%= loggedinuser.image %> " alt="" />
                <input type="text" name="comment" id="loggedinusercommentinput" placeholder="Write Comment →"  oninput="loggedinusercheckInput()"/>
                <input id="loggedinusercommentsubmit"  type="submit" value="post" />
              </form>
              <% const fileExtension = post.postimage.split('.').pop().toLowerCase(); %>
              <% if (fileExtension === 'mp4' || fileExtension === 'mkv') { %>
                <video loop autoplay muted style="width: 100%; max-height: 100%; object-fit: cover;" src="../images/allposts/<%= post.postimage %>" alt="Video"></video>
                <%}else{ %>
              <img src="../images/allposts/<%= post.postimage %>" alt="" />
              <% } %>
              <div id="commentbox" class="commentbox_<%=post._id%>" >
                <% var commentsForPost=allcomments.filter(comment=>comment.postid.equals(post._id)); %>
                   <% commentsForPost.forEach(function(comment) { %>
                    <div id="commentwala">
                                <a href="<%= (comment.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + comment.userid._id %>">
                      <img style="
              height: 4vh;
              margin-left: 2vh;
              width: 4vh;
              overflow: hidden;
              border-radius: 50%;
              flex-shrink: 0;
              margin-right: 2vh;
            " src="../images/allposts/<%= comment.userid.image %> " alt="" /></a>
                      <h5  style="word-wrap: break-word;word-break: break-all;">
                        <%=comment.comment%>
                      </h5>
                    </div>
                    <%})%>
              </div>
            </div>
            <h3><%=post.caption%></h3>
            <div id="homepostsfootericons">
              <% if (post.likes.includes(loggedinuser.id)){ %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i style="color: red;" class="ri-heart-3-fill"></i>
                </a>
              <% } else { %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i class="ri-heart-3-line"></i>
                </a>
              <% } %>
              <i class="ri-chat-3-line"></i>
              <% if (loggedinuser.archieve.includes(post._id)){%>
                <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-fill"></i></a>
                <% } else {%>
                  <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-line"></i></a>
              <%}%>        
            </div>
            <div id="homepostsfooter">
              <h2 id="likeCount_<%= post._id %>"><%= post.likes.length %> likes</h2>
              <h2 id="commentcount_<%= post._id %>"  >
                <%= post.comments.length %> comment
              </h2>
            </div>
          </div>
      <%})%>
    <% loggedinuser.posts.reverse().forEach(function(post){ %>
          <div id="homeposts">
            <div id="homepostsnav">
              <a href="<%= (post.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + post.userid._id %>"
                style=" font-size: 1.5vw; color: white; text-decoration: none; display: flex; gap: 2vh;">
                <div id="homepostnavprofile">
                  <img src="../images/allposts/<%= loggedinuser.image %>" alt="" />
                </div>
                <h2><%= loggedinuser.username %></h2>
             </a>
              <%if(loggedinuser.id == post.userid._id){%>
                <div id="options">
                  <a href="/delete/<%=post._id%>">Delete</a>
                  <i class="ri-more-2-line"></i>
                </div>
                <%}else{%>
                  <a href="/unfollow/<%=post.userid._id%>"><button  style=" margin-left: 1vh;;padding: .7vh 1.5vh;  background-color:transparent; color: white;border-radius: 10px; border: none; font-size: 1vw;">Following</button></a> 
                <%}%>            
            </div>
            <div id="homepostsprofile">
              <form id="commentForm" data-id="<%=post._id%>" action="/comment/<%=post._id%>" method="post">
                <img style="
            height: 4vh;
            margin-left: 2vh;
            width: 4vh;
            overflow: hidden;
            border-radius: 50%;
          " src="../images/allposts/<%= loggedinuser.image %> " alt="" />
                <input type="text" name="comment" id="loggedinusercommentinput" placeholder="Write Comment →"  oninput="loggedinusercheckInput()"/>
                <input id="loggedinusercommentsubmit"  type="submit" value="post" />
              </form>
              <% const fileExtension = post.postimage.split('.').pop().toLowerCase(); %>
              <% if (fileExtension === 'mp4' || fileExtension === 'mkv') { %>
                <video loop autoplay muted style="width: 100%; max-height: 100%; object-fit: cover;" src="../images/allposts/<%= post.postimage %>" alt="Video"></video>
                <%}else{ %>
              <img src="../images/allposts/<%= post.postimage %>" alt="" />
              <% } %>
              <div id="commentbox" class="commentbox_<%=post._id%>" >
                <% var commentsForPost=allcomments.filter(comment=>comment.postid.equals(post._id)); %>
                   <% commentsForPost.forEach(function(comment) { %>
                    <div id="commentwala">
                                <a href="<%= (comment.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + comment.userid._id %>">
                      <img style="
              height: 4vh;
              margin-left: 2vh;
              width: 4vh;
              overflow: hidden;
              border-radius: 50%;
              flex-shrink: 0;
              margin-right: 2vh;
            " src="../images/allposts/<%= comment.userid.image %> " alt="" /></a>
                      <h5  style="word-wrap: break-word;word-break: break-all;">
                        <%=comment.comment%>
                      </h5>
                    </div>
                    <%})%>
              </div>
            </div>
            <h3><%=post.caption%></h3>
            <div id="homepostsfootericons">
              <% if (post.likes.includes(loggedinuser.id)){ %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i style="color: red;" class="ri-heart-3-fill"></i>
                </a>
              <% } else { %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i class="ri-heart-3-line"></i>
                </a>
              <% } %>
              <i class="ri-chat-3-line"></i>
              <% if (loggedinuser.archieve.includes(post._id)){%>
                <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-fill"></i></a>
                <% } else {%>
                  <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-line"></i></a>
              <%}%>        
            </div>
            <div id="homepostsfooter">
              <h2 id="likeCount_<%= post._id %>"><%= post.likes.length %> likes</h2>
              <h2 id="commentcount_<%= post._id %>"  >
                <%= post.comments.length %> comment
              </h2>
            </div>
          </div>
      <%})%>
      <div id="caughtup">
        <h3>Suggested Posts</h3>
      </div>
      <% notfollowedposts.reverse().forEach(function(post){ %>
        <div id="homeposts">
          <div id="homepostsnav">
            <a href="<%= (post.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + post.userid._id %>"
              style=" font-size: 1.5vw; color: white; text-decoration: none; display: flex; gap: 2vh;">
              <div id="homepostnavprofile">
                <img src="../images/allposts/<%= post.userid.image %>" alt="" />
              </div>
              <h2><%= post.userid.username %></h2>
           </a>
            <%if(loggedinuser.id == post.userid._id){%>
              <div id="options">
                <a href="/delete/<%=post._id%>">Delete</a>
                <i class="ri-more-2-line"></i>
              </div>
              <%}else{%>
                <a href="/follow/<%=post.userid._id%>"><button  style=" margin-left: 1vh;;padding: .7vh 1.5vh;  background-color:transparent; color: #679cff;border-radius: 10px; border: none; font-size: 2vh;">Follow</button></a> 
              <%}%>            
          </div>
          <div id="homepostsprofile">
              <form id="commentForm" data-id="<%=post._id%>" action="/comment/<%=post._id%>" method="post">
                <img style="
            height: 4vh;
            margin-left: 2vh;
            width: 4vh;
            overflow: hidden;
            border-radius: 50%;
          " src="../images/allposts/<%= loggedinuser.image %> " alt="" />
                <input type="text" name="comment" id="loggedinusercommentinput" placeholder="Write Comment →"  oninput="loggedinusercheckInput()"/>
                <input id="loggedinusercommentsubmit"  type="submit" value="post" />
              </form>
              <% const fileExtension = post.postimage.split('.').pop().toLowerCase(); %>
              <% if (fileExtension === 'mp4' || fileExtension === 'mkv') { %>
                <video loop autoplay muted style="width: 100%; max-height: 100%; object-fit: cover;" src="../images/allposts/<%= post.postimage %>" alt="Video"></video>
                <%}else{ %>
              <img src="../images/allposts/<%= post.postimage %>" alt="" />
              <% } %>
              <div id="commentbox" class="commentbox_<%=post._id%>" >
                <% var commentsForPost=allcomments.filter(comment=>comment.postid.equals(post._id)); %>
                   <% commentsForPost.forEach(function(comment) { %>
                    <div id="commentwala">
                                <a href="<%= (comment.userid._id == loggedinuser.id) ? '/profile' : '/profile/' + comment.userid._id %>">
                      <img style="
              height: 4vh;
              margin-left: 2vh;
              width: 4vh;
              overflow: hidden;
              border-radius: 50%;
              flex-shrink: 0;
              margin-right: 2vh;
            " src="../images/allposts/<%= comment.userid.image %> " alt="" /></a>
                      <h5  style="word-wrap: break-word;word-break: break-all;">
                        <%=comment.comment%>
                      </h5>
                    </div>
                    <%})%>
              </div>
            </div>
            <h3><%=post.caption%></h3>
            <div id="homepostsfootericons">
              <% if (post.likes.includes(loggedinuser.id)){ %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i style="color: red;" class="ri-heart-3-fill"></i>
                </a>
              <% } else { %>
                <a href="#" onclick="handleLike('<%= post._id %>')" id="likeButton_<%= post._id %>">
                  <i class="ri-heart-3-line"></i>
                </a>
              <% } %>
              <i class="ri-chat-3-line"></i>
              <% if (loggedinuser.archieve.includes(post._id)){%>
                <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-fill"></i></a>
                <% } else {%>
                  <a href="/archieve/<%=post._id%>"><i class="ri-bookmark-line"></i></a>
              <%}%>        
            </div>
            <div id="homepostsfooter">
              <h2 id="likeCount_<%= post._id %>"><%= post.likes.length %> likes</h2>
              <h2 id="commentcount_<%= post._id %>"  >
                <%= post.comments.length %> comment
              </h2>
            </div>
        </div>
    <%})%>
      

  </div>

  <% include ./partials/footer.ejs %>

  
  <script>

function checkInput() {
      var inputValue = document.getElementById("loggedinusercommentinput").value;
      var submitButton = document.getElementById("loggedinusercommentsubmit");
      submitButton.disabled = inputValue.trim().length === 0;
    }
    
function loggedinusercheckInput() {
      var inputValue = document.getElementById("loggedinusercommentinput").value;
      var submitButton = document.getElementById("loggedinusercommentsubmit");
      submitButton.disabled = inputValue.trim().length === 0;
    }

function handleLike(postId) {
    axios.post(`/like/${postId}`)
      .then(response => {
        // Assuming the response contains updated like count
        const likeCountElement = document.getElementById(`likeCount_${postId}`);
        likeCountElement.innerText = `${response.data.likesCount} likes`;

        // Update the like button appearance based on the response
        const likeButton = document.getElementById(`likeButton_${postId}`);
        if (response.data.isLiked) {
          likeButton.innerHTML = '<i style="color: red;" class="ri-heart-3-fill"></i>';
        } else {
          likeButton.innerHTML = '<i class="ri-heart-3-line"></i>';
        }
      })
      .catch(error => {
        console.error('Error handling like:', error);
      });
  }









document.querySelectorAll(".ri-more-2-line").forEach(function (moreButton) {
  var flag = 0;

  moreButton.addEventListener("click", function (e) {
    var del = e.target.parentElement.childNodes[1];
    if (flag === 0) {
      del.style.display = "initial";
      flag = 1;
    } else {
      del.style.display = "none";
      flag = 0;
    }
  });
});



    document.querySelectorAll(".ri-chat-3-line").forEach(function(dets){
      flag=0
      dets.addEventListener("click",function(event){
        if (flag==0){
          comment=event.srcElement.parentElement.parentElement.childNodes[3].childNodes[5]
          commentform = event.srcElement.parentElement.parentElement.childNodes[3].childNodes[1]
        comment.style.bottom="0%"
        comment.style.opacity=1
        commentform.style.bottom="0%"
        commentform.style.opacity=1
        flag=1
        }else{
          comment=event.srcElement.parentElement.parentElement.childNodes[3].childNodes[5]
          commentform = event.srcElement.parentElement.parentElement.childNodes[3].childNodes[1]
        comment.style.bottom="-100%"
        comment.style.opacity=0
        commentform.style.bottom="-100%"
        commentform.style.opacity=0

        flag=0
        }
      })
    })


    
document.querySelectorAll("#commentForm").forEach(function (form) {
  form.addEventListener("submit", function (event) {
    event.preventDefault();
    const commentInput = form.querySelector("#loggedinusercommentinput").value;
    const postId = form.getAttribute("data-id");
    axios.post(`/comment/${postId}`, { comment: commentInput })
      .then(function (response) {
        // Adjusted the querySelector to find the correct comment count element
        const commentcountElement = document.querySelector(`#commentcount_${postId}`);
        if (commentcountElement) {
          commentcountElement.innerText = `${response.data.comment.commentscount} comments`;
        }
        updateComments(response.data.comment, postId);
        const prevUrl = response.data.prevUrl || '/home';
        history.pushState(null, null, prevUrl);
        form.reset();
      })
      .catch(function (error) {
        console.error(error);
      });
  });
});

function updateComments(comment, postId) {
  console.log(comment, postId);
  const commentContainer = document.querySelector(`.commentbox_${postId}`);
  const newCommentElement = document.createElement("div");
  newCommentElement.classList.add("commentwala");
  newCommentElement.innerHTML = `
    <div id="commentwala" class="commentwala_${comment.postid}">
      <a href="${(comment.userid._id == "<%=loggedinuser.id%>") ? '/profile' : '/profile/' + comment.userid._id}">
        <img  style="
              height: 4vh;
              margin-left: 2vh;
              width: 4vh;
              overflow: hidden;
              border-radius: 50%;
              flex-shrink: 0;
              margin-right: 2vh;
            "src="../images/allposts/${comment.userid.image}" alt="" />
      </a>
      <h5 style="word-wrap: break-word; word-break: break-all;">${comment.comment}</h5>
    </div>
  `;



  if (commentContainer) {
    if (commentContainer.firstChild) {
      commentContainer.insertBefore(newCommentElement, commentContainer.firstChild);
    } else {
      commentContainer.appendChild(newCommentElement);
    }
    console.log("Comment element added");
  } else {
    console.error(`Comment container .comm_${postId} not found.`);
  }
}








// JavaScript
document.addEventListener('DOMContentLoaded', () => {
    const fileInput = document.getElementById("createstoryinput");
    const imagePreview = document.getElementById('storyimagePreview');

    fileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];

        if (file) {
            const reader = new FileReader();

            reader.onload = () => {
                // Check if the file is a video
                if (file.type.startsWith('video/')) {
                    const video = document.createElement('video');
                    video.src = reader.result;
                    video.controls = true;
                    video.width = "100%"; // Adjust width as needed
                    video.height = "100%"; // Adjust height as needed
                    imagePreview.innerHTML = '';
                    imagePreview.appendChild(video);
                } else {
                    // If it's not a video, you can handle it as an image (as in your original code)
                    const img = new Image();
                    img.src = reader.result;
                    imagePreview.innerHTML = '';
                    imagePreview.appendChild(img);
                }
            }
            reader.readAsDataURL(file);
        } else {
            imagePreview.innerHTML = '';
        }
    });
});


  document.querySelector("#createstory").addEventListener("click",function(){
    document.querySelector("#createstorydiv").style.display = "flex"
  })
  document.querySelector("#storynav .ri-close-line").addEventListener("click",function(){
    document.querySelector("#createstorydiv").style.display = "none"
  })

  var flag=0
  document.querySelector(".ri-text").addEventListener("click",(function(){
    if (flag==0){
      document.querySelector("#storytxt textarea").style.color="black"
      document.querySelector(".ri-text").style.color="black"
      // document.querySelector(".ri-text").style.borderColor="black"
      flag=1
    }else if(flag==1){
      document.querySelector("#storytxt textarea").style.color="aqua"
      document.querySelector(".ri-text").style.color="aqua"
      // document.querySelector(".ri-text").style.borderColor="aqua"
      flag=2
    }else if(flag==2){
      document.querySelector("#storytxt textarea").style.color="red"
      document.querySelector(".ri-text").style.color="red"
      // document.querySelector(".ri-text").style.borderColor="red"
      flag=3
    }else{
      document.querySelector("#storytxt textarea").style.color="white"
      document.querySelector(".ri-text").style.color="white"
      // document.querySelector(".ri-text").style.borderColor="white"
      flag=0
    }
  }
  ))  

  var count=0
  document.querySelector(".ri-send-backward").addEventListener("click",(function(){
    if (count==0){
      document.querySelector(".ri-send-backward").style.color="black"
      // document.querySelector(".ri-send-backward").style.borderColor="black",
      document.querySelector("#createstorydivbox").style.background="none"
      document.querySelector("#createstorydivbox").style.backgroundColor="black"

      count=1
    }else if(count==1){
      document.querySelector("#createstorydivbox").style.backgroundColor="grey"
      document.querySelector(".ri-send-backward").style.color="grey"
      // document.querySelector(".ri-send-backward").style.borderColor="grey"
      count=2
    }else if(count==2){
      document.querySelector("#createstorydivbox").style.backgroundColor="blue"
      document.querySelector(".ri-send-backward").style.color="blue"
      // document.querySelector(".ri-send-backward").style.borderColor="blue"
      count=3
    }else{
      document.querySelector("#createstorydivbox").style.background="linear-gradient( #f9ce34, #ee2a7b , #6228d7)"
      document.querySelector(".ri-send-backward").style.color="white"
      // document.querySelector(".ri-send-backward").style.borderColor="white"
      count=0
    }
  }
  ))  
  
document.querySelector(".ri-gallery-line")
.addEventListener("click", function () {
  document.querySelector("#createstoryinput").click();
})


  document.querySelector("#done")
.addEventListener("click", function () {
  document.querySelector("#storyform").submit();
})



  </script>